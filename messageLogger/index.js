(function(o,n,u,r,t){"use strict";t.storage.messageCache??={};const a=[];function h(){const e=Date.now();let s=0;for(const g in t.storage.messageCache)e-t.storage.messageCache[g].timestamp>1728e5&&(delete t.storage.messageCache[g],s++);s>0&&r.logger.log(`MessageLogger: Pruned ${s} expired messages from cache.`)}function c(e){!e?.id||!e.content||e.author?.bot||(t.storage.messageCache[e.id]={content:e.content,author:e.author?.username??"unknown",timestamp:Date.now()})}var i={onLoad:function(){h(),a.push(n.FluxDispatcher.subscribe("MESSAGE_CREATE",function({message:e}){c(e)})),a.push(n.FluxDispatcher.subscribe("MESSAGE_UPDATE",function({message:e}){e.content&&t.storage.messageCache[e.id]&&c(e)})),a.push(n.FluxDispatcher.subscribe("MESSAGE_DELETE",function(e){if(t.storage.messageCache[e.id]){const s=t.storage.messageCache[e.id];u.showToast(`Deleted from ${s.author}: ${s.content}`),delete t.storage.messageCache[e.id]}})),r.logger.log("MessageLogger loaded with persistent storage strategy.")},onUnload:function(){for(const e of a)e?.();a.length=0,r.logger.log("MessageLogger unloaded.")}};return o.default=i,Object.defineProperty(o,"__esModule",{value:!0}),o})({},vendetta.metro.common,vendetta.ui.toasts,vendetta,vendetta.plugin);
