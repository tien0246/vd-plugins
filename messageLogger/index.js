(function(d,n,g,i,t,m,E,h){"use strict";const{View:C,Text:l}=n.ReactNative;function y({channelId:a}){return n.React.createElement(C,{style:{flex:1,backgroundColor:"#1E1F22",justifyContent:"center",alignItems:"center"}},n.React.createElement(l,{style:{color:"white",fontSize:18,fontWeight:"bold"}},"Hello from DeletedMessagesLog!"),n.React.createElement(l,{style:{color:"white",marginTop:8}},"This is a test page."),n.React.createElement(l,{style:{color:"white",marginTop:8}},"Channel ID: ",a))}const{TouchableOpacity:M,View:I}=h.General,b=g.findByStoreName("ChannelStore"),u=2*24*60*60*1e3;t.storage.messageCache??={},t.storage.deletedMessages??={};const o=[];function D(){const a=Date.now();Object.keys(t.storage.messageCache).forEach(function(e){a-t.storage.messageCache[e].timestamp>u&&delete t.storage.messageCache[e]}),Object.keys(t.storage.deletedMessages).forEach(function(e){t.storage.deletedMessages[e]=t.storage.deletedMessages[e].filter(function(s){return a-new Date(s.deletedTimestamp).getTime()<u})})}function w(a){if(!a?.id||!a.content||a.author?.bot)return;const e=t.storage.messageCache[a.id];t.storage.messageCache[a.id]={content:a.content,author:a.author?.username??"unknown",timestamp:Date.now(),editHistory:e?.editHistory??[]}}function S({channelId:a,channelName:e}){const s=n.NavigationNative.useNavigation();return n.React.createElement(M,{onPress:function(){s.push("VendettaCustomPage",{title:`Deleted Msgs in #${e}`,render:function(){return n.React.createElement(y,{channelId:a})}})},style:{position:"absolute",right:50,top:13,zIndex:1}},n.React.createElement(h.Forms.FormIcon,{source:E.getAssetIDByName("ic_trash_24px")}))}var v={onLoad:function(){D(),o.push(n.FluxDispatcher.subscribe("MESSAGE_CREATE",function({message:e}){return w(e)})),o.push(n.FluxDispatcher.subscribe("MESSAGE_UPDATE",function({message:e}){const s=t.storage.messageCache[e.id];if(s&&e.content&&s.content!==e.content){const r=s.editHistory??[];r.push({content:s.content,timestamp:s.timestamp}),t.storage.messageCache[e.id]={...s,content:e.content,timestamp:Date.now(),editHistory:r}}})),o.push(n.FluxDispatcher.subscribe("MESSAGE_DELETE",function(e){const s=t.storage.messageCache[e.id];s&&(t.storage.deletedMessages[e.channelId]??=[],t.storage.deletedMessages[e.channelId].unshift({id:e.id,content:s.content,author:s.author,deletedTimestamp:new Date().toISOString()}),t.storage.deletedMessages[e.channelId].length>100&&t.storage.deletedMessages[e.channelId].pop(),delete t.storage.messageCache[e.id])}));const a=g.findByName("ChannelHeader",!1);a?o.push(m.instead("default",a,function(e,s){const r=s(...e),c=e[0]?.channelId;if(!c)return r;const f=b.getChannel(c);return!f||!(t.storage.deletedMessages[c]?.length>0)?r:n.React.createElement(I,{style:{flex:1}},r,n.React.createElement(S,{channelId:c,channelName:f.name}))})):i.logger.error("MessageLogger: Could not find ChannelHeader component"),i.logger.log("MessageLogger loaded with UI.")},onUnload:function(){o.forEach(function(a){return a?.()}),o.length=0,i.logger.log("MessageLogger unloaded.")}};return d.default=v,Object.defineProperty(d,"__esModule",{value:!0}),d})({},vendetta.metro.common,vendetta.metro,vendetta,vendetta.plugin,vendetta.patcher,vendetta.ui.assets,vendetta.ui.components);
