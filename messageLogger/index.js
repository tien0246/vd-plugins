(function(i,c,r,u,h,s,m,S,p){"use strict";r.findByProps("openLazy","hideActionSheet"),r.findByProps("ActionSheetRow"),r.findByProps("push","pop"),r.findByStoreName("ChannelStore");const f=2*24*60*60*1e3;s.storage.messageCache??={},s.storage.deletedMessages??={};const a=[];function C(){const t=Date.now();Object.keys(s.storage.messageCache).forEach(function(e){t-s.storage.messageCache[e].timestamp>f&&delete s.storage.messageCache[e]}),Object.keys(s.storage.deletedMessages).forEach(function(e){s.storage.deletedMessages[e]=s.storage.deletedMessages[e].filter(function(n){return t-new Date(n.deletedTimestamp).getTime()<f})})}function y(t){if(!t?.id||!t.content||t.author?.bot)return;const e=s.storage.messageCache[t.id];s.storage.messageCache[t.id]={content:t.content,author:t.author?.username??"unknown",timestamp:Date.now(),editHistory:e?.editHistory??[]}}function l(t,e=0){if(!t||e>15)return"";let n="";const o="  ".repeat(e),d=t.type?.displayName??t.type?.name??t.type??"[unknown]";if(n+=`${o}${d}
`,t.props?.children){const E=Array.isArray(t.props.children)?t.props.children:[t.props.children];for(const b of E)n+=l(b,e+1)}return n}let g=!1;var M={onLoad:function(){C(),a.push(c.FluxDispatcher.subscribe("MESSAGE_CREATE",function({message:e}){return y(e)})),a.push(c.FluxDispatcher.subscribe("MESSAGE_UPDATE",function({message:e}){const n=s.storage.messageCache[e.id];if(n&&e.content&&n.content!==e.content){const o=n.editHistory??[];o.push({content:n.content,timestamp:n.timestamp}),s.storage.messageCache[e.id]={...n,content:e.content,timestamp:Date.now(),editHistory:o}}})),a.push(c.FluxDispatcher.subscribe("MESSAGE_DELETE",function(e){const n=s.storage.messageCache[e.id];n&&(s.storage.deletedMessages[e.channelId]??=[],s.storage.deletedMessages[e.channelId].unshift({id:e.id,content:n.content,author:n.author,deletedTimestamp:new Date().toISOString()}),s.storage.deletedMessages[e.channelId].length>100&&s.storage.deletedMessages[e.channelId].pop(),delete s.storage.messageCache[e.id])}));const t=r.findByName("ChannelHeader",!1);t?a.push(m.after("default",t,function(e,n){const o=e[0]?.channelId;if(!o||g||!(s.storage.deletedMessages[o]?.length>0))return;g=!0;const d=l(n);p.showConfirmationAlert({title:"ChannelHeader Tree",content:d,confirmText:"Copy",onConfirm:function(){c.clipboard.setString(d),u.showToast("Copied to clipboard.")},cancelText:"Close"})})):h.logger.error("MessageLogger: Could not find ChannelHeader component"),h.logger.log("MessageLogger loaded for debugging component tree.")},onUnload:function(){a.forEach(function(t){return t?.()}),a.length=0,g=!1,h.logger.log("MessageLogger unloaded.")}};return i.default=M,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta.metro.common,vendetta.metro,vendetta.ui.toasts,vendetta,vendetta.plugin,vendetta.patcher,vendetta.ui.components,vendetta.ui.alerts);
