(function(d,c,a,p,i,t,C,y,w,M){"use strict";a.findByProps("openLazy","hideActionSheet"),a.findByProps("ActionSheetRow"),a.findByProps("push","pop"),a.findByStoreName("ChannelStore");const h=2*24*60*60*1e3;t.storage.messageCache??={},t.storage.deletedMessages??={};const n=[];function E(){const s=Date.now();Object.keys(t.storage.messageCache).forEach(function(e){s-t.storage.messageCache[e].timestamp>h&&delete t.storage.messageCache[e]}),Object.keys(t.storage.deletedMessages).forEach(function(e){t.storage.deletedMessages[e]=t.storage.deletedMessages[e].filter(function(o){return s-new Date(o.deletedTimestamp).getTime()<h})})}function b(s){if(!s?.id||!s.content||s.author?.bot)return;const e=t.storage.messageCache[s.id];t.storage.messageCache[s.id]={content:s.content,author:s.author?.username??"unknown",timestamp:Date.now(),editHistory:e?.editHistory??[]}}let g=!1;var S={onLoad:function(){E(),n.push(c.FluxDispatcher.subscribe("MESSAGE_CREATE",function({message:e}){return b(e)})),n.push(c.FluxDispatcher.subscribe("MESSAGE_UPDATE",function({message:e}){const o=t.storage.messageCache[e.id];if(o&&e.content&&o.content!==e.content){const r=o.editHistory??[];r.push({content:o.content,timestamp:o.timestamp}),t.storage.messageCache[e.id]={...o,content:e.content,timestamp:Date.now(),editHistory:r}}})),n.push(c.FluxDispatcher.subscribe("MESSAGE_DELETE",function(e){const o=t.storage.messageCache[e.id];o&&(t.storage.deletedMessages[e.channelId]??=[],t.storage.deletedMessages[e.channelId].unshift({id:e.id,content:o.content,author:o.author,deletedTimestamp:new Date().toISOString()}),t.storage.deletedMessages[e.channelId].length>100&&t.storage.deletedMessages[e.channelId].pop(),delete t.storage.messageCache[e.id])}));const s=a.findByName("ChannelHeader",!1);s?n.push(C.after("default",s,function(e,o){const r=e[0]?.channelId;if(!r||g||!(t.storage.deletedMessages[r]?.length>0))return;g=!0;const f=new Set;y.findInReactTree(o,function(m){if(m?.props){const l=Object.keys(m.props);l.length>0&&f.add(`[${l.join(", ")}]`)}return!1});const u=Array.from(f).join(`
`);M.showConfirmationAlert({title:"Component Prop Keys",content:u||"No components with props found.",confirmText:"Copy",onConfirm:function(){c.clipboard.setString(u),p.showToast("Copied to clipboard.")},cancelText:"Close"})})):i.logger.error("MessageLogger: Could not find ChannelHeader component"),i.logger.log("MessageLogger loaded for debugging component tree.")},onUnload:function(){n.forEach(function(s){return s?.()}),n.length=0,g=!1,i.logger.log("MessageLogger unloaded.")}};return d.default=S,Object.defineProperty(d,"__esModule",{value:!0}),d})({},vendetta.metro.common,vendetta.metro,vendetta.ui.toasts,vendetta,vendetta.plugin,vendetta.patcher,vendetta.utils,vendetta.ui.components,vendetta.ui.alerts);
