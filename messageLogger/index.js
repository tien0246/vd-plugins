(function(d,c,a,u,i,t,l,E,m){"use strict";a.findByProps("openLazy","hideActionSheet"),a.findByProps("ActionSheetRow"),a.findByProps("push","pop"),a.findByStoreName("ChannelStore");const h=2*24*60*60*1e3;t.storage.messageCache??={},t.storage.deletedMessages??={};const n=[];function p(){const s=Date.now();Object.keys(t.storage.messageCache).forEach(function(e){s-t.storage.messageCache[e].timestamp>h&&delete t.storage.messageCache[e]}),Object.keys(t.storage.deletedMessages).forEach(function(e){t.storage.deletedMessages[e]=t.storage.deletedMessages[e].filter(function(o){return s-new Date(o.deletedTimestamp).getTime()<h})})}function C(s){if(!s?.id||!s.content||s.author?.bot)return;const e=t.storage.messageCache[s.id];t.storage.messageCache[s.id]={content:s.content,author:s.author?.username??"unknown",timestamp:Date.now(),editHistory:e?.editHistory??[]}}let g=!1;var y={onLoad:function(){p(),n.push(c.FluxDispatcher.subscribe("MESSAGE_CREATE",function({message:e}){return C(e)})),n.push(c.FluxDispatcher.subscribe("MESSAGE_UPDATE",function({message:e}){const o=t.storage.messageCache[e.id];if(o&&e.content&&o.content!==e.content){const r=o.editHistory??[];r.push({content:o.content,timestamp:o.timestamp}),t.storage.messageCache[e.id]={...o,content:e.content,timestamp:Date.now(),editHistory:r}}})),n.push(c.FluxDispatcher.subscribe("MESSAGE_DELETE",function(e){const o=t.storage.messageCache[e.id];o&&(t.storage.deletedMessages[e.channelId]??=[],t.storage.deletedMessages[e.channelId].unshift({id:e.id,content:o.content,author:o.author,deletedTimestamp:new Date().toISOString()}),t.storage.deletedMessages[e.channelId].length>100&&t.storage.deletedMessages[e.channelId].pop(),delete t.storage.messageCache[e.id])}));const s=a.findByName("ChannelHeader",!1);s?n.push(l.after("default",s,function(e,o){const r=e[0]?.channelId;if(!r||g||!(t.storage.deletedMessages[r]?.length>0))return;g=!0;const M=Object.keys(o??{}).join(", "),b=Object.keys(o?.props??{}).join(", "),f=`res keys: [${M}]

props keys: [${b}]`;m.showConfirmationAlert({title:"Header Render Output",content:f,confirmText:"Copy",onConfirm:function(){c.clipboard.setString(f),u.showToast("Copied to clipboard.")},cancelText:"Close"})})):i.logger.error("MessageLogger: Could not find ChannelHeader component"),i.logger.log("MessageLogger loaded for debugging component tree.")},onUnload:function(){n.forEach(function(s){return s?.()}),n.length=0,g=!1,i.logger.log("MessageLogger unloaded.")}};return d.default=y,Object.defineProperty(d,"__esModule",{value:!0}),d})({},vendetta.metro.common,vendetta.metro,vendetta.ui.toasts,vendetta,vendetta.plugin,vendetta.patcher,vendetta.ui.components,vendetta.ui.alerts);
