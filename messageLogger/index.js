(function(n,c,i,r,s){"use strict";s.storage.messageCache??={};const o=[];function g(){const e=Date.now();let t=0;for(const a in s.storage.messageCache)e-s.storage.messageCache[a].timestamp>1728e5&&(delete s.storage.messageCache[a],t++);t>0&&r.logger.log(`MessageLogger: Pruned ${t} expired messages from cache.`)}function d(e){if(!e?.id||!e.content||e.author?.bot)return;const t=s.storage.messageCache[e.id];s.storage.messageCache[e.id]={content:e.content,author:e.author?.username??"unknown",timestamp:Date.now(),editHistory:t?.editHistory??[]}}var h={onLoad:function(){g(),o.push(c.FluxDispatcher.subscribe("MESSAGE_CREATE",function({message:e}){d(e)})),o.push(c.FluxDispatcher.subscribe("MESSAGE_UPDATE",function({message:e}){const t=s.storage.messageCache[e.id];if(t&&e.content&&t.content!==e.content){const a=t.editHistory??[];a.push({content:t.content,timestamp:t.timestamp}),s.storage.messageCache[e.id]={...t,content:e.content,timestamp:Date.now(),editHistory:a},i.showToast(`Edited: ${t.content.slice(0,20)}... -> ${e.content.slice(0,20)}...`)}})),o.push(c.FluxDispatcher.subscribe("MESSAGE_DELETE",function(e){if(s.storage.messageCache[e.id]){const t=s.storage.messageCache[e.id];i.showToast(`Deleted from ${t.author}: ${t.content}`),delete s.storage.messageCache[e.id]}})),r.logger.log("MessageLogger loaded with persistent storage strategy.")},onUnload:function(){for(const e of o)e?.();o.length=0,r.logger.log("MessageLogger unloaded.")}};return n.default=h,Object.defineProperty(n,"__esModule",{value:!0}),n})({},vendetta.metro.common,vendetta.ui.toasts,vendetta,vendetta.plugin);
